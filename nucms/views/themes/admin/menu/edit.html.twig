{% extends 'base.html.twig' %}

{% block subnav %}

    {% include 'menu/subnav.html.twig' %}

{% endblock %}

{% block body %}

    <div class="container">

        {% include 'menu/toolbar.html.twig' %}

    </div>

    <div class="container">

        <!-- menu items -->
        <div class="row">
            <div class="col-sm-6">

                <div id="menu-items">
                    {{ menu_items_controller.lists(menu.id, locale) | raw }}
                </div><!--/menu-items-->

            </div>
            <div class="col-sm-6">

                <div class="editBox">
                    <!-- add item buttons -->
                    <div class="addButtons text-right">
                        <button class="btn btn-orange" type="button" data-type="1">{{ lang('menu.text.add_slug') }}</button>
                        <button class="btn btn-orange" type="button" data-type="2">{{ lang('menu.text.add_page') }}</button>
                    </div>

                    <div class="addItemsInputs form-horizontal">

                        <!-- add item type 1 -->
                        <div class="addItem type1">

                            {{ form_open(current_full_url(), {'id': 'menu-add-form-1', 'class': 'form-horizontal', 'novalidate': 'novalidate'}) }}

                                <div class="actionsButtons text-right">
                                    <button type="button" class="btn btn-default btn-sm closeAddItem">{{ lang('text.cancel') }}</button>
                                    <button type="button" class="btn btn-save btn-sm menuAdd" data-menu_type="1">{{ lang('text.add') }}</button>
                                </div>

                                <!-- margin -->
                                <div class="clearfix baseMargin"></div>

                                <div class="form-group">
                                    <label for="add_name_1" class="col-sm-3 control-label">{{ lang('menu.form.name') }}:</label>
                                    <div class="col-sm-9">
                                        {{ form_input({'name': 'name', 'class': 'form-control add_menu_item_1', 'id': 'add_name_1', 'required': 'required' }) }}
                                    </div>
                                    <div class="clearfix"></div>
                                </div>

                                <div class="form-group">
                                    <label for="add_url_1" class="col-sm-3 control-label">{{ lang('menu.form.slug') }}:</label>
                                    <div class="col-sm-9">
                                        {{ form_input({'name': 'url', 'class': 'form-control add_menu_item_1', 'id': 'add_url_1', 'required': 'required' }) }}
                                    </div>
                                    <div class="clearfix"></div>
                                </div>

                                {{ form_hidden('type', 1) }}

                            {{ form_close() }}

                        </div>

                        <!-- add item type 2 -->
                        <div class="addItem type2">

                            {{ form_open(current_full_url(), {'id': 'menu-add-form-2', 'class': 'form-horizontal', 'novalidate': 'novalidate'}) }}

                                <div class="actionsButtons text-right">
                                    <button type="button" class="btn btn-default btn-sm closeAddItem">{{ lang('text.cancel') }}</button>
                                    <button type="button" class="btn btn-save btn-sm menuAdd" data-menu_type="2">{{ lang('text.add') }}</button>
                                </div>

                                <!-- margin -->
                                <div class="clearfix baseMargin"></div>

                                <div class="form-group">
                                    <label for="add_name_2" class="col-sm-3 control-label">{{ lang('menu.form.name') }}:</label>
                                    <div class="col-sm-9">
                                        {{ form_input({'name': 'name', 'class': 'form-control add_menu_item_2', 'id': 'add_name_2', 'required': 'required' }) }}
                                    </div>
                                    <div class="clearfix"></div>
                                </div>

                                <div class="form-group">
                                    <label for="add_url_1" class="col-sm-3 control-label">{{ lang('menu.form.page') }}:</label>
                                    <div class="col-sm-9">
                                        {{ form_nu_dropdown({'class': 'form-control add_menu_item_2', 'name': 'primary_key', 'required': 'required'}, pages_options) | raw }}
                                    </div>
                                    <div class="clearfix"></div>
                                </div>

                                {{ form_hidden('type', 2) }}

                            {{ form_close() }}

                        </div>

                    </div>

                    <div class="editItemInputs form-horizontal"></div>
                </div>

                <!-- margin -->
                <div class="clearfix baseMargin"></div>

                {{ form_open(current_full_url(), {'id': 'menu-edit-form', 'class': 'form-horizontal', 'novalidate': 'novalidate'}) }}

                <!-- name -->
                <div class="form-group">
                    <div class="col-sm-3 control-label">{{ lang('menu.form.name') }}</div>
                    <div class="col-sm-9">
                        {{ form_input({'name': 'name', 'value': menu.name, 'class': 'form-control', 'id': 'name', 'required': 'required' }) }}
                    </div>
                </div>

                <!-- active -->
                <div class="form-group">
                    <label for="active" class="col-sm-3 control-label">{{ lang('menu.form.active') }}</label>
                    <div class="col-sm-9">
                        <span class="superCheck">
                            <label for="active"></label>
                            {{ form_checkbox({'name': 'active', 'id': 'active'}, 1, menu.active) }}
                            <span></span>
                        </span>
                    </div>
                </div>

                <!-- position -->
                <div class="form-group">
                    <div class="col-sm-3 control-label">{{ lang('menu.form.position') }}</div>
                    <div class="col-sm-9">
                        {{ form_nu_dropdown({'name': 'position', 'required': 'required'}, config.menu.positions, menu.position) | raw }}
                    </div>
                </div>

                <!-- margin -->
                <div class="clearfix baseMargin"></div>

                <!-- buttons -->
                <div class="row">
                    <div class="col-xs-12">
                        <div class="col-xs-12 text-right">
                            <a href="{{ admin_url('menu/delete') }}" rel="{{ menu.id }}" class="btn btn-red btn-margin-left btn-margin-right deleteRecord" data-confirmMsg="{{ lang('menu.text.confirm_delete') }}" data-redirectUrl="{{ admin_url('menu') }}"><i class="ion ion-android-delete tableActions-delete"></i>{{ lang('menu.text.delete') }}</a>
                            <button class="btn btn-save" type="submit"><i class="ion ion-checkmark"></i>{{ lang('text.save') }}</button>
                        </div>
                    </div>
                </div>

                <input type="hidden" name="nested_order" id="nested_order" value="">

                {{ form_close() }}

                <!-- margin -->
                <div class="clearfix baseMargin"></div>

            </div>
        </div>

    </div>

{% endblock %}


{% block javascript %}

    {{ parent() }}

    <script src="{{ asset('js/jquery.mjs.nestedSortable.js') }}"></script>
    <script>

        // -- run nested sortable after load
        runNestedSortable('.menu-items', '');

        // -- add menu item
        $(document).on('click', '.menuAdd', function() {

            var type = parseInt($(this).attr('data-menu_type'));
            var data = $('#menu-add-form-'+type).serialize();

            $.post('{{ admin_url('menu/menu-items/add/')~menu.id~'?locale='~locale }}', data, function (response) {

                if (parseInt(response.result) === 1) {

                    $("#menu-items").load('{{ admin_url('menu-items/lists/'~menu.id~'/'~locale) }}', function() {
                        $('.addItem').hide();
                        $('.addButtons').show();
                        runNestedSortable('.menu-items', '');
                    });

                }

            });

            return false;

        });

        // -- save menu item
        $(document).on('click', '.menuSave', function() {

            var data = $('#menu-item-edit-form').serialize();
            var idItem = parseInt($(this).attr('data-id'));

            $.post("{{ admin_url('menu/menu-items/save/') }}"+idItem, data, function(response) {
                console.log(response);
                if (parseInt(response.result) === 1) { 

                    $('#item_'+idItem).find('.menu_item_name').html($('#edit_name').val());

                    $('.addItem').hide();
                    $('.addButtons').show();
                    $('.editItemInputs').html('');

                }
            });

            return false;

        });

        // -- edit menu item
        $(document).on('click', '.menuEdit', function() {

            var id = parseInt($(this).attr('rel'));

            $('.editItemInputs').html('');

            $('.editItemInputs').load('{{ admin_url('menu/menu-items/edit/') }}'+id+'/{{ locale }}', function(response) {
                $('.addButtons').hide();
            });

        });

        // -- show add inputs
        $(document).on('click', '.addButtons button', function() {

            var type = parseInt($(this).attr('data-type'));
            $('.addItem.type'+type).show();
            $('.addButtons').hide();

        });

        // -- close add inputs
        $(document).on('click', '.closeAddItem', function() {

            $('.addItem').hide();
            $('.addButtons').show();
            $('.editItemInputs').html('');

        });

    </script>

{% endblock %}